services:
  rsyslog:
    build: ./rsyslog
    container_name: deriva-logging
    restart: unless-stopped
    networks:
      internal_network:
        ipv4_address: ${RSYSLOG_IP}
    healthcheck:
      test: ["CMD", "timeout", "2", "bash", "-c", "</dev/tcp/127.0.0.1/514"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 5s
    volumes:
      - logs:/var/log/shared
      - ./rsyslog/entrypoint.sh:/deriva/logging/rsyslog/entrypoint.sh
    entrypoint: ["/bin/bash", "/deriva/logging/rsyslog/entrypoint.sh"]
